const data = [
  {
    "grado": 4,
    "nombre": "ROBERT DANIEL DE LEON DELGADO",
    "ci": "30518617"
  },
  {
    "grado": 4,
    "nombre": "DARIO ALEJANDRO ARAUJO CALERO",
    "ci": "34331386"
  },
  {
    "grado": 4,
    "nombre": "MARCELO ANDRES LEONE OTORMIN",
    "ci": "30775764"
  },
  {
    "grado": 4,
    "nombre": "MIGUEL ANGEL MEDINA GARCIA",
    "ci": "30516562"
  },
  {
    "grado": 4,
    "nombre": "JOSE TEIXEIRA ARRIGONNI",
    "ci": "40819176"
  },
  {
    "grado": 3,
    "nombre": "EDUARDO MARCELO IROLDI AMARILLA",
    "ci": "26709795"
  },
  {
    "grado": 3,
    "nombre": "RODRIGO SEBASTIAN BEGUIRISTAIN RIOS",
    "ci": "47778943"
  },
  {
    "grado": 3,
    "nombre": "NESTOR EDGARDO REYES ACOSTA",
    "ci": "25464285"
  },
  {
    "grado": 3,
    "nombre": "PAULINO JAVIER VIDAL URRETA",
    "ci": "38221119"
  },
  {
    "grado": 3,
    "nombre": "JAVIER DARIO DANGELO BARTOLOTTA",
    "ci": "40847246"
  },
  {
    "grado": 3,
    "nombre": "MARCOS GABRIEL RODRIGUEZ RECCIOPPE",
    "ci": "44291681"
  },
  {
    "grado": 3,
    "nombre": "BRIAN NICOLAS LOPEZ DALUZ",
    "ci": "43805857"
  },
  {
    "grado": 3,
    "nombre": "FERNANDO GASTON MEDEROS MAIDANA",
    "ci": "42831990"
  },
  {
    "grado": 3,
    "nombre": "MARIELA VILORIA NUÑEZ",
    "ci": "31858199"
  },
  {
    "grado": 2,
    "nombre": "LUCIO CAETANO CABALLERO PIRIZ",
    "ci": "42263854"
  },
  {
    "grado": 2,
    "nombre": "ADRIAN FRANCISCO TERRA IGNACIO",
    "ci": "35851383"
  },
  {
    "grado": 2,
    "nombre": "ALEXANDER ANDRES POMBO BEROIS",
    "ci": "51425055"
  },
  {
    "grado": 2,
    "nombre": "JUAN MARTIN MERLO PEREZ",
    "ci": "35667198"
  },
  {
    "grado": 2,
    "nombre": "ALBERTO GABRIEL NOBLE LEMOS",
    "ci": "35508534"
  },
  {
    "grado": 2,
    "nombre": "ESTEBAN DANIEL MURCHIO HERNANDEZ",
    "ci": "47554442"
  },
  {
    "grado": 2,
    "nombre": "MATHIAS CONO MAZZETTI SALAZAR",
    "ci": "48681533"
  },
  {
    "grado": 2,
    "nombre": "DANILO MARIO GALLERO TORRES",
    "ci": "43951723"
  },
  {
    "grado": 2,
    "nombre": "ENZO JAVIER FERRAZ QUIROGA",
    "ci": "17930535"
  },
  {
    "grado": 2,
    "nombre": "LEONARDO FABIAN ZULUETA CALISIOTTI",
    "ci": "46485129"
  },
  {
    "grado": 2,
    "nombre": "BRUNO DORNELLES GUTIERREZ",
    "ci": "46947761"
  },
  {
    "grado": 2,
    "nombre": "MILTON DANILO BERRIEL ESPINO",
    "ci": "43340360"
  },
  {
    "grado": 2,
    "nombre": "PABLO SEBASTIAN MADERA CAMACHO",
    "ci": "26278247"
  },
  {
    "grado": 2,
    "nombre": "EDGAR DARIO DI BIANCO",
    "ci": "30909086"
  },
  {
    "grado": 2,
    "nombre": "ENZO DA SILVA VASCONCELLOS",
    "ci": "42780563"
  },
  {
    "grado": 2,
    "nombre": "MARCOS NUÑEZ PICANZO",
    "ci": "47756193"
  },
  {
    "grado": 2,
    "nombre": "MILTON DANILO BERRIEL ESPINO",
    "ci": "47131399"
  },
  {
    "grado": 2,
    "nombre": "RAFAEL MERNIES GONZALEZ",
    "ci": "32530572"
  },
  {
    "grado": 2,
    "nombre": "BRAULIO CEDRES BARRETO",
    "ci": "42362476"
  },
  {
    "grado": 1,
    "nombre": "LUIS FERNANDO RODRIGUEZ SENI",
    "ci": "46688294"
  },
  {
    "grado": 1,
    "nombre": "MARCOS CESAR LIMA ROYANO",
    "ci": "45049118"
  },
  {
    "grado": 1,
    "nombre": "JOSE MARIA AMARILLO",
    "ci": "26066139"
  },
  {
    "grado": 1,
    "nombre": "DILAN RECALDE REMEDIOS",
    "ci": "54531427"
  },
  {
    "grado": 1,
    "nombre": "ANA KARINA PIRIZ TIRON",
    "ci": "34286298"
  },
  {
    "grado": 1,
    "nombre": "LUIS ALFREDO BAES FERNANDEZ",
    "ci": "48561858"
  },
  {
    "grado": 1,
    "nombre": "CRISTIAN DANIEL OLIVERA GONZALEZ",
    "ci": "49460869"
  },
  {
    "grado": 1,
    "nombre": "ANDREE MICHAEL SENA MOLLO",
    "ci": "34707765"
  },
  {
    "grado": 1,
    "nombre": "ARIEL VICTOR SILVA LAPORTA",
    "ci": "39736793"
  },
  {
    "grado": 1,
    "nombre": "VERONICA INES YANIBELLI GARCIA",
    "ci": "45148962"
  },
  {
    "grado": 1,
    "nombre": "IGNACIO GERVASINI",
    "ci": "52202656"
  },
  {
    "grado": 1,
    "nombre": "BRUNO MAXIMILIANO MAGALLAN JORAJURA",
    "ci": "46147345"
  },
  {
    "grado": 1,
    "nombre": "JONATAN NAHUEL VICENTE DOMINGUEZ",
    "ci": "53217315"
  },
  {
    "grado": 1,
    "nombre": "PABLO CRISTINO FAGUNDEZ",
    "ci": "46381648"
  },
  {
    "grado": 1,
    "nombre": "LUCAS SEBASTIAN ALMEIDA LOPEZ",
    "ci": "54428276"
  },
  {
    "grado": 1,
    "nombre": "FACUNDO AGUSTIN MURAÑA RIVERO",
    "ci": "49849572"
  },
  {
    "grado": 1,
    "nombre": "JONATHAN NOEL PINATO COLMAN",
    "ci": "50912231"
  },
  {
    "grado": 1,
    "nombre": "ATANASILDO PEREZ CAMPO",
    "ci": "26234590"
  },
  {
    "grado": 1,
    "nombre": "MARTIN ENRIQUE MUNIZ CASTRO",
    "ci": "44604377"
  },
  {
    "grado": 1,
    "nombre": "ALFREDO ENRIQUE OLIVERA BAZAN",
    "ci": "41835490"
  },
  {
    "grado": 1,
    "nombre": "GONZALO PEREZ SANCHEZ",
    "ci": "50717970"
  },
  {
    "grado": 1,
    "nombre": "CAMILO PROTTI",
    "ci": "50668284"
  },
  {
    "grado": 1,
    "nombre": "FEDERICO NICOLAS BENITEZ SILVERA",
    "ci": "51100718"
  },
  {
    "grado": 1,
    "nombre": "CESAR GOMEZ BORDAGORRY",
    "ci": "50724539"
  },
  {
    "grado": 1,
    "nombre": "JUAN GONZALEZ",
    "ci": "55147041"
  },
  {
    "grado": 1,
    "nombre": "ALFREDO DAVID PEREYRA SIERRA",
    "ci": "52466052"
  },
  {
    "grado": 1,
    "nombre": "NICOLAS LEONEL DIAZ MUÑOZ",
    "ci": "46759837"
  },
  {
    "grado": 1,
    "nombre": "RODOLFO RAMON DENIZ MARCENAL",
    "ci": "39989437"
  },
  {
    "grado": 1,
    "nombre": "ALEXANDER FACUNDO ROLANDE SOUZA",
    "ci": "51550181"
  },
  {
    "grado": 1,
    "nombre": "DIEGO ABEL SILVEIRA AREVALO",
    "ci": "46518285"
  },
  {
    "grado": 1,
    "nombre": "ANDRES BLECICH",
    "ci": "55086150"
  },
  {
    "grado": 1,
    "nombre": "CHRISTIAN ALEXIS FERNANDEZ GARCIA",
    "ci": "46736566"
  },
  {
    "grado": 1,
    "nombre": "MAXIMILIANO EZEQUIEL MEDINA MONTES",
    "ci": "48732023"
  },
  {
    "grado": 1,
    "nombre": "MICHAEL BERMUDEZ",
    "ci": "54021822"
  },
  {
    "grado": 1,
    "nombre": "VALENTINA NUÑEZ CHALART",
    "ci": "46014308"
  },
  {
    "grado": 1,
    "nombre": "MATIAS CARRION DIAZ",
    "ci": "53645580"
  },
  {
    "grado": 1,
    "nombre": "FEDERICO VINCENT BUVE MARICHAL",
    "ci": "46789654"
  },
  {
    "grado": 1,
    "nombre": "EDUARDO DARIO FARIAS PERDOMO",
    "ci": "53268198"
  },
  {
    "grado": 1,
    "nombre": "JONATHAN DANIEL MARQUEZ MARQUEZ",
    "ci": "52059354"
  },
  {
    "grado": 1,
    "nombre": "PABLO MARTIN PEREIRA PEREIRA",
    "ci": "50482771"
  },
  {
    "grado": 1,
    "nombre": "WASHINGTON ALEXANDER PIÑEIRO FERRO",
    "ci": "53471777"
  },
  {
    "grado": 1,
    "nombre": "MARXIO WILMAR CABRERA SMITH",
    "ci": "48057928"
  },
  {
    "grado": 1,
    "nombre": "MARCOS NAHUEL RECONDO REYES",
    "ci": "51051367"
  },
  {
    "grado": 1,
    "nombre": "LUCAS GASPARIK ARADA",
    "ci": "55087853"
  },
  {
    "grado": 1,
    "nombre": "CHRISTIAN EDUARDO CASTRO PEREZ",
    "ci": "53266134"
  },
  {
    "grado": 1,
    "nombre": "DIEGO EZEQUIEL ROVIRA MACHADO",
    "ci": "49694852"
  },
  {
    "grado": 1,
    "nombre": "CAMILA VAZLLAGUNO",
    "ci": "49473256"
  },
  {
    "grado": 1,
    "nombre": "MARIA ALEJANDRA ESTEVEZ RAMOS",
    "ci": "48901858"
  },
  {
    "grado": 1,
    "nombre": "GIAN GIACOBONI",
    "ci": "48626212"
  },
  {
    "grado": 1,
    "nombre": "PABLO GERMAN NICOLAS RODRIGUEZ",
    "ci": "51112054"
  },
  {
    "grado": 1,
    "nombre": "VICTOR IVAN FARIAS FERREIRA",
    "ci": "49132038"
  },
  {
    "grado": 1,
    "nombre": "STEFANIA ABANONI",
    "ci": "45815147"
  },
  {
    "grado": 1,
    "nombre": "EMILIANO FORLANO GONZALEZ",
    "ci": "51015377"
  },
  {
    "grado": 1,
    "nombre": "MARIA VICTORIA RODRIGUEZ DIAZ",
    "ci": "47328241"
  },
  {
    "grado": 1,
    "nombre": "EDUARD MARTIN ALMEIDA GONZALEZ",
    "ci": "51458705"
  },
  {
    "grado": 1,
    "nombre": "CRISTIAN EMANUEL MARTINEZ MENYOU",
    "ci": "52852631"
  },
  {
    "grado": 1,
    "nombre": "RODRIGO PEREZ CORREA",
    "ci": "50998132"
  },
  {
    "grado": 1,
    "nombre": "LUCIA PEREZ CASTRO",
    "ci": "54064779"
  },
  {
    "grado": 1,
    "nombre": "BRUNO ARIAS SUAREZ",
    "ci": "52396322"
  },
  {
    "grado": 1,
    "nombre": "MATHIAS ABREU ESPOSITO",
    "ci": "47323207"
  },
  {
    "grado": 1,
    "nombre": "JULIA MARIA de ARMAS QUIMBO",
    "ci": "50316508"
  },
  {
    "grado": 1,
    "nombre": "ROBERTO MARTIN BALADAN TEJEDOR",
    "ci": "38806290"
  },
  {
    "grado": 1,
    "nombre": "ANA CAROLINA BRAZ FERNANDEZ",
    "ci": "52639980"
  },
  {
    "grado": 1,
    "nombre": "RUBEN DAVID COCOREL DE LOS SANTOS",
    "ci": "53261582"
  },
  {
    "grado": 1,
    "nombre": "PABLO JAVIER CORREA CORRALES",
    "ci": "49447883"
  },
  {
    "grado": 1,
    "nombre": "ANGIE LORELEY DA ROSA MACEDO",
    "ci": "54341222"
  },
  {
    "grado": 1,
    "nombre": "EZEQUIEL DOS SANTOS DE LOS SANTOS",
    "ci": "54223636"
  },
  {
    "grado": 1,
    "nombre": "BRANDON NAHUEL EMANUELE FERRADA",
    "ci": "54773471"
  },
  {
    "grado": 1,
    "nombre": "SEBASTIAN FRANCIA",
    "ci": "52894073"
  },
  {
    "grado": 1,
    "nombre": "MACARENA GARCILAZO",
    "ci": "49893818"
  },
  {
    "grado": 1,
    "nombre": "KATYA NICOL GOMEZ INZAURRALDE",
    "ci": "51077298"
  },
  {
    "grado": 1,
    "nombre": "JUAN IGNACIO GONZALEZ BLANCO",
    "ci": "55147041"
  },
  {
    "grado": 1,
    "nombre": "GERARDO MARTIN GONZALEZ CALDERON",
    "ci": "49967425"
  },
  {
    "grado": 1,
    "nombre": "ALBERTO GERMAN GONZALEZ CHIRICO",
    "ci": "53846083"
  },
  {
    "grado": 1,
    "nombre": "ROMINA MICAEL GONZALEZ RIVERO",
    "ci": "54902000"
  },
  {
    "grado": 1,
    "nombre": "ALFONSO MATIAS GUTIERREZ ALDERETE",
    "ci": "47290458"
  },
  {
    "grado": 1,
    "nombre": "ALEX DANIEL LATORRE COLMAN",
    "ci": "49107772"
  },
  {
    "grado": 1,
    "nombre": "FLORENCIA ESTEFANIA MACHADO GOMEZ",
    "ci": "55284015"
  },
  {
    "grado": 1,
    "nombre": "DIEGO IGNACIO MILICHI VARGAS",
    "ci": "49423223"
  },
  {
    "grado": 1,
    "nombre": "EMANUEL MOLINÉ SUAREZ",
    "ci": "54148072"
  },
  {
    "grado": 1,
    "nombre": "CECILIA BELEN MORALES PICARDO",
    "ci": "53557896"
  },
  {
    "grado": 1,
    "nombre": "RYAN MICHAEL NAVAS ROSAS",
    "ci": "53216117"
  },
  {
    "grado": 1,
    "nombre": "CRISTIAN FEDERICO NEVES RODRIGUEZ",
    "ci": "51033052"
  },
  {
    "grado": 1,
    "nombre": "DIEGO NICOLAS OLIVERA SILVEIRA",
    "ci": "53593375"
  },
  {
    "grado": 1,
    "nombre": "DIEGO MARTIN PAMPILLON PEREYRA",
    "ci": "53677151"
  },
  {
    "grado": 1,
    "nombre": "ANDRES ALEXIS PERDOMO LORENZO",
    "ci": "48702115"
  },
  {
    "grado": 1,
    "nombre": "SILVIO MAURICIO PEREIRA PINTOS",
    "ci": "51019157"
  },
  {
    "grado": 1,
    "nombre": "EMELY ESTEFANY PEREYRA SILVA",
    "ci": "53455551"
  },
  {
    "grado": 1,
    "nombre": "GABRIEL ALEJANDRO PRETO SANDOVAL",
    "ci": "47584388"
  },
  {
    "grado": 1,
    "nombre": "CAMILO ALFONSO PROTTI GODIÑO",
    "ci": "50668284"
  },
  {
    "grado": 1,
    "nombre": "CYNTHIA BELEN RAMOS PACHECO",
    "ci": "54287038"
  },
  {
    "grado": 1,
    "nombre": "SABRINA SOLEDAD RAMOS TORRES",
    "ci": "46603143"
  },
  {
    "grado": 1,
    "nombre": "BRUNO MAURICIO RIBEIRO SEVERO",
    "ci": "51776442"
  },
  {
    "grado": 1,
    "nombre": "JOEL RODRIGUEZ ABELLAN",
    "ci": "54003749"
  },
  {
    "grado": 1,
    "nombre": "GUSTAVO DANIEL RODRIGUEZ ACOSTA",
    "ci": "48836673"
  },
  {
    "grado": 1,
    "nombre": "RICHARD MAXIMILIANO RODRIGUEZ ESTEVEZ",
    "ci": "48740567"
  },
  {
    "grado": 1,
    "nombre": "FIAMA ALEJANDRA RODRIGUEZ FERREIRA",
    "ci": "52595281"
  },
  {
    "grado": 1,
    "nombre": "LEONARDO SANTIAGO RODRIGUEZ FONSECA",
    "ci": "49229386"
  },
  {
    "grado": 1,
    "nombre": "ISAIAS RODRIGUEZ RODRIGUEZ",
    "ci": "54905977"
  },
  {
    "grado": 1,
    "nombre": "FEDERICO ANDRES SALVARREY VAZQUEZ",
    "ci": "53843677"
  },
  {
    "grado": 1,
    "nombre": "ALEJANDRO TOBIAS SANCHES CUESTAS",
    "ci": "51011575"
  },
  {
    "grado": 1,
    "nombre": "CAMILA VALERIA SANTOS RODRIGUEZ",
    "ci": "50017023"
  },
  {
    "grado": 1,
    "nombre": "ARIANA SANTURIO GONZALEZ",
    "ci": "53408489"
  },
  {
    "grado": 1,
    "nombre": "EVER EXEQUIEL SOSA PEREIRA",
    "ci": "55865849"
  },
  {
    "grado": 1,
    "nombre": "JOAQUIN NICOLAS TORRES GIMENEZ",
    "ci": "51233460"
  },
  {
    "grado": 1,
    "nombre": "MARTIN EMANUEL VEGA GOMEZ",
    "ci": "47167916"
  },
  {
    "grado": 1,
    "nombre": "ANIBAL ADRIAN VIERA TEJERA",
    "ci": "46677770"
  },
  {
    "grado": 1,
    "nombre": "EDISNON GABRIEL VILLALBA MONZON",
    "ci": "51212824"
  },
  {
    "grado": 1,
    "nombre": "LUIS JONATHAN COSTA PAIVA",
    "ci": "45814911"
  },
  {
    "grado": 1,
    "nombre": "BRAULIO ANDRES CEDRES BARRETO",
    "ci": "42362476"
  },
  {
    "grado": 1,
    "nombre": "JUAN PAIS",
    "ci": "49799343"
  },
  {
    "grado": 1,
    "nombre": "YONATHAN SALDIVIA BRAGA",
    "ci": "50694942"
  }
];

const searchInput = document.getElementById('searchInput');
const searchButton = document.getElementById('searchButton');
const searchResults = document.getElementById('searchResults');
const turnoSelect = document.getElementById('turnoSelect');
const movilInput = document.getElementById('movilInput');
const addButton = document.getElementById('addButton');
const guardarButton = document.getElementById('guardarButton');
const addedList = document.getElementById('addedList');
const fechaInput = document.getElementById('fechaInput');
let selectedPerson = null;
let addedPeople = [];

// Load added people from local storage on page load
function loadAddedPeople() {
    const storedData = localStorage.getItem('addedPeople');
    if (storedData) {
        addedPeople = JSON.parse(storedData);
        renderAddedList();
    }
}

function searchNames() {
    const query = searchInput.value.trim().toUpperCase();
    searchResults.innerHTML = '';
    if (query.length > 0) {
        const results = data.filter(item => item.Nombre && item.Nombre.toUpperCase().includes(query));
        results.forEach(item => {
            const div = document.createElement('div');
            div.textContent = item.Nombre;
            div.onclick = () => selectPerson(item);
            searchResults.appendChild(div);
        });

        if (results.length === 0) {
            searchResults.innerHTML = '<div>No se encontraron resultados</div>';
        }
    }
}

function selectPerson(person) {
    selectedPerson = person;
    searchInput.value = person.Nombre;
    searchResults.innerHTML = '';
    addButton.style.display = 'block';  
    if (!turnoSelect.disabled) return; 

    turnoSelect.disabled = false;
    fechaInput.disabled = false;
}

function getFirstNameAndLastName(fullName) {
    const parts = fullName.split(' ');
    const firstName = parts[0];
    let lastName;

    if (parts.length > 2) {
        lastName = parts.slice(2).join(' ');
    } else {
        lastName = parts.length > 1 ? parts[1] : ''; 
    }

    return { firstName, lastName };
}

function agregarDatos() {
    if (!selectedPerson) {
        alert('Por favor, selecciona un nombre.');
        return;
    }

    const { firstName, lastName } = getFirstNameAndLastName(selectedPerson.Nombre);
    const turno = turnoSelect.value;
    const movil = movilInput.value.trim();
    const fecha = fechaInput.value; 

    if (!fecha) {
        alert('Por favor, selecciona una fecha.');
        return;
    }

    const newEntry = {
        "Grado": selectedPerson.Grado,
        "Nombre": firstName,  
        "Apellido": lastName, 
        "C.I": selectedPerson["C.I"],  
        "Movil": movil,
        "Fecha": fecha,  
        "Turno": turno
    };

    addedPeople.push(newEntry);
    saveToLocalStorage();
    renderAddedList();
    searchInput.value = '';
    searchResults.innerHTML = '';
    movilInput.value = '';
  
    addButton.style.display = 'none';  
    selectedPerson = null; 
}

function renderAddedList() {
    addedList.innerHTML = '';
    addedPeople.forEach((entry, index) => {
        const li = document.createElement('li');
        const textDiv = document.createElement('div');
        textDiv.innerHTML = `${entry.Nombre} ${entry.Apellido} - Turno ${entry.Turno} - Móvil ${entry.Movil} - Fecha ${entry.Fecha}`;

        const button = document.createElement('button');
        button.textContent = 'Eliminar';
        button.onclick = () => removeEntry(index);
        button.style.width = '80px';
        button.style.height = '30px';
        button.style.marginTop = '4px';

        li.appendChild(textDiv);
        li.appendChild(button);
        addedList.appendChild(li);
    });

    const addedListContainer = document.getElementById('addedListContainer');
    addedListContainer.style.display = addedPeople.length > 0 ? 'block' : 'none';
}

function removeEntry(index) {
    addedPeople.splice(index, 1);
    saveToLocalStorage();
    renderAddedList();
}

function saveToLocalStorage() {
    localStorage.setItem('addedPeople', JSON.stringify(addedPeople));
}

function guardarDatos() {
    if (addedPeople.length === 0) {
        alert('No hay datos para guardar.');
        return;
    }

    const worksheet = XLSX.utils.json_to_sheet(addedPeople);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Datos');
    XLSX.writeFile(workbook, 'datos_turnos.xlsx');
}

// Load data from local storage when the page loads
window.onload = loadAddedPeople;

searchButton.addEventListener('click', searchNames);
searchInput.addEventListener('input', searchNames); 
addButton.addEventListener('click', agregarDatos);
guardarButton.addEventListener('click', guardarDatos);
